#!/bin/bash

[[ "$#" -eq 0 ]] && {
    echo "Usage: $0 file_from [fole_to]" >&2
    exit 0
}

from="$1"
[[ ! -f "$1" ]] && {
    echo "ERROR: File convert from \"$1\" was not found." >&2
    exit 1
}

to=
if [[ "$#" -eq 1 ]]; then
    to="${1%.*}.gif"
else
    to="$2"
fi
dir="$(dirname "${to}")"

[[ -d "${dir}" ]] || {
    echo "ERROR: directory \"${dir}\" was not found."
    exit 1
}

# https://askubuntu.com/questions/506670/how-to-do-i-convert-an-webm-video-to-a-animated-gif-on-the-command-line
file_name="$(basename ${to})"
tmp_file_path="/tmp/tmp_${file_name}"
ffmpeg -i "$from" -pix_fmt rgb8 "${tmp_file_path}" || {
    echo "ERROR: Failed to convert \"${from}\" to \"${to}\"" >&2
    exit 1
}

mv "${tmp_file_path}" "${to}" || {
    echo "ERROR: Failed to convert \"${from}\" to \"${to}\"" >&2
    exit 1
}

echo "INFO: Converted \"${from}\" to \"${to}\" with animated gif"

